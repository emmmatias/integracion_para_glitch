doctype html
html
    head
        title= title
    style.
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            html, body {
                height: 100%;
                background-image: linear-gradient(180deg, #FFFFFF 60%, #f2295b 100%);
            }
            .container {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100%;
                background-color: #f0f0f0; 
            }
            .box {
                font-family: Arial, Helvetica, sans-serif;
                width: 90%; 
                max-width: 400px; 
                padding: 20px;
                background-color: #ffffff; 
                color: black;
                text-align: center;
                border-radius: 8px; 
            }
            .box input{
                border-radius: 8px;
            }
            .box label{
                margin-top: 5%;
            }
    body
        div.container
            div.box
                h1= formTitle
                form#miform(action=formaction, method='post')
                    div
                        input#user_id(type="text", value=id, name='id', hidden)
                        label(for='usuario') Ingresá tu DNI (será tu usuario):
                        br
                        input#usuario(type='text', name='usuario', value=usuario || '', placeholder= 'Tu usuario', required)
                        br
                        label(for='contrasena') Creá una contraseña:
                        br
                        input#contrasena(type='text', name='contrasena', value=contrasena || '', placeholder='contraseña', required)
                        br
                        label(for='contacto_tienda') Nombre de la tienda:
                        br
                        input#contacto_tienda(type='text', value=contacto_tienda || '', name='contacto_tienda', placeholder='Nombre de la tienda', required)
                        br
                        label(for='direccion') Direccion de retiro:
                        br
                        input#direccion(type='text', name='direccion', value=direccion || '', placeholder=direccion, required)
                        br
                        label(for='email') Email:
                        br
                        input#email(type='email', value=email || '', name='email', placeholder=email, required)
                        br
                        label(for='cp_tienda') Código postal:
                        br
                        input#cp_tienda(type='text', value=cp_tienda || '', name='cp_tienda', placeholder='Código Postal', required)
                        br
                        label(for='whatsapp') WhatsApp:
                        br
                        input#whatsapp(type='text', value=whatsapp || '',name='whatsapp', placeholder=whatsapp, required)
                        br
                        label(for='telefono') Teléfono:
                        br
                        input#telefono(type='text', value=whatsapp || '',name='telefono', placeholder=telefono, required)
                        br
                        label(for='metodo_pago') Método de pago:
                        br
                        input#metodo_pago(type='text', value=metodo_pago || '',name='metodo_pago', placeholder='Tu método de pago', required)
                        br
                        br
                        button(type='submit') Enviar
                p Los datos serán utilizados para poder dar de alta su usuario en nuestro sistema, la dirección debe ser la de retiro de los paquetes. Como por ejemplo 'av santa fe 4465, piso, depto, localidad'
    script.
        let form = document.getElementById('miform');

        function validarNumero(telefono) {
            const regex = /^\+\d{13}$/;
            return regex.test(telefono);
        }

        function validarEmail(email) {
            const emailRegex = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
            return emailRegex.test(email);
        }

        form.addEventListener('submit', (event) => {
            event.preventDefault();
            
            let validador = 0;
            let usuario = document.querySelector('#usuario').value
            let contrasena = document.querySelector('#contrasena').value
            let user_id = document.querySelector('#user_id').value
            let metodo_pago = document.querySelector('#metodo_pago').value;
            let telefono = document.querySelector('#telefono').value;
            let whatsapp = document.querySelector('#whatsapp').value;
            let cp_tienda = document.querySelector('#cp_tienda').value;
            let contacto_tienda = document.querySelector('#contacto_tienda').value;
            let direccion = document.querySelector('#direccion').value;
            let email = document.querySelector('#email').value;

            if (validarNumero(telefono)) {
                validador++;
            } else {
                alert('El número de teléfono debe comenzar con +549 sin espacios');
            }

            if (direccion != 'No definido' && direccion != '') {
                validador++;
            } else {
                alert('La dirección no puede estar vacía o ser "No definido"');
            }

            if (validarNumero(whatsapp)) {
                validador++;
            } else {
                alert('El número de WhatsApp debe comenzar con +549 sin espacios');
            }

            if (validarEmail(email)) {
                validador++;
            } else {
                alert('El email no es válido');
            }
            
            if (validador === 4) {
                let body = {
                    contrasena,
                    usuario,
                    id: user_id,
                    telefono,
                    whatsapp,
                    metodo_pago,
                    direccion,
                    cp_tienda,
                    contacto_tienda,
                    email
                };

                fetch('/registro', {
                    method: 'POST',
                    body: JSON.stringify(body),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if(response.ok){
                         return response.text()
                    }
                })
                .then(html => {
                    document.body.innerHTML = html
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('Error al enviar el formulario');
                });
            } else {
                alert('Error al enviar el formulario');
            }
        });
        